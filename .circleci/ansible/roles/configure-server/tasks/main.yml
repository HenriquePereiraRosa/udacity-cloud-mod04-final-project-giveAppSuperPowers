---
- name: "update apt packages."
  become: yes
  apt:
    update_cache: yes

- name: "upgrade packages"
  become: yes
  apt:
    upgrade: "yes"

- name: remove dependencies that are no longer required
  become: yes
  apt:
    autoremove: yes

- name: "install node & npm."
  become: yes
  apt:
    name: ["nodejs", "npm"]
    state: latest
    update_cache: yes

- name: "install pm2"
  become: yes
  npm:
    name: pm2
    global: yes
    production: yes
    state: present

- name: "install docker"
  # Your code here
  become: yes
  raw: |
    sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
    
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
    
    echo \
    "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

    sudo apt-get update
    sudo apt-get install docker-ce docker-ce-cli containerd.io
  
  changed_when: false

- name: "install docker compose."
  # Your code here
  become: yes
  raw: |
    curl -L https://github.com/docker/compose/releases/download/1.25.3/docker-compose-`uname -s`-`uname -m` > ~/docker-compose &&
    chmod +x ~/docker-compose &&
    sudo mv ~/docker-compose /usr/local/bin/docker-compose
  changed_when: false

  
- name: "run postgres copntainer."
  # Your code here
  become: yes
  raw: |
    docker-compose up -d
    docker run -d postgres
    docker container ls
  changed_when: false