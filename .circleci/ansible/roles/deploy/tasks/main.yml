---

- name: Copy backend to temp
  become: true
  copy:
    src: /root/project/backend.tar.gz
    dest: /tmp

- name: Unzip backend
  become: true
  unarchive:
    src: /tmp/backend.tar.gz
    dest: /home/ubuntu
    remote_src: yes

- name: cd backend
  shell: |
    cd backend
    
- name: npm install -g npm@latest
  shell: |
    sudo npm install -g npm@latest
    
- name: npm audit fix
  shell: |
    sudo npm audit fix
    
- name: npm install
  shell: |
    sudo npm install
    
- name: Build
  shell: |
    sudo npm run build

- name: Start Sever
  shell: |
    sudo npm start:prod